<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.85.0" /><link rel="canonical" type="text/html" href="https://github.com/rancher-sandbox/cOS-toolkit/docs/customizing/">
<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="shortcut icon" href="https://github.com/rancher-sandbox/cOS-toolkit/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="https://github.com/rancher-sandbox/cOS-toolkit/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="https://github.com/rancher-sandbox/cOS-toolkit/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="https://github.com/rancher-sandbox/cOS-toolkit/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="https://github.com/rancher-sandbox/cOS-toolkit/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="https://github.com/rancher-sandbox/cOS-toolkit/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="https://github.com/rancher-sandbox/cOS-toolkit/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="https://github.com/rancher-sandbox/cOS-toolkit/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="https://github.com/rancher-sandbox/cOS-toolkit/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="https://github.com/rancher-sandbox/cOS-toolkit/favicons/android-192x192.png" sizes="192x192">

<title>Customizing | cOS toolkit</title>
<meta name="description" content="cOS toolkit documentation website"><meta property="og:title" content="Customizing" />
<meta property="og:description" content="This section contains various articles relative on how to customize cOS, branding and behavior.
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://github.com/rancher-sandbox/cOS-toolkit/docs/customizing/" /><meta property="og:site_name" content="cOS toolkit" />

<meta itemprop="name" content="Customizing">
<meta itemprop="description" content="This section contains various articles relative on how to customize cOS, branding and behavior.
"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Customizing"/>
<meta name="twitter:description" content="This section contains various articles relative on how to customize cOS, branding and behavior.
"/>




<link rel="preload" href="https://github.com/rancher-sandbox/cOS-toolkit/scss/main.min.ce822e1833a5405e77f69584ab31fd4bd422643124926787ea63be001e51b0b2.css" as="style">
<link href="https://github.com/rancher-sandbox/cOS-toolkit/scss/main.min.ce822e1833a5405e77f69584ab31fd4bd422643124926787ea63be001e51b0b2.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script
  src="https://unpkg.com/lunr@2.3.8/lunr.min.js"
  integrity="sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY"
  crossorigin="anonymous"></script>



<link rel="stylesheet" href="https://github.com/rancher-sandbox/cOS-toolkit/css/prism.css"/>





<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-00000000-0', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="https://github.com/rancher-sandbox/cOS-toolkit/">
		<span class="navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="text-uppercase font-weight-bold">cOS toolkit</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link active" href="https://github.com/rancher-sandbox/cOS-toolkit/docs/" ><span class="active">Documentation</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="https://github.com/rancher-sandbox/cOS-toolkit/releases" target="_blank" ><i class='fab fa-github'></i><span>Github releases</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="https://rancher-sandbox.github.io/cos-toolkit-package-browser/" target="_blank" ><i class='fa fa-toolbox'></i><span>Browse packages</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">



<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="https://github.com/rancher-sandbox/cOS-toolkit/offline-search-index.16218b789da3ed98fdbaeb49bd2ae2d0.json"
  data-offline-search-base-href="https://github.com/rancher-sandbox/cOS-toolkit/"
  data-offline-search-max-results="10"
>

</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="https://github.com/rancher-sandbox/cOS-toolkit/docs/customizing/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Customizing</h1>
<div class="lead">This section contains various articles relative on how to customize cOS, branding and behavior.</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-8637cd7f2ce65f4c97959f4d2a723eb9">Stages</a></li>


    
  
    
    
	
<li>2: <a href="#pg-80272a2426a531df16f16d019ccd6724">Configuration persistency</a></li>


    
  
    
    
	
<li>3: <a href="#pg-0f49c1b2fa940427a27c2c93a1d67077">Runtime persistent changes</a></li>


    
  
    
    
	
<li>4: <a href="#pg-aab355bcbb96f01ee8dabb0f90e6df5a">General Configuration</a></li>


    
  
    
    
	
<li>5: <a href="#pg-4c6f31346340371adbb7fd2ceccc2e88">Login</a></li>


    
  
    
    
	
<li>6: <a href="#pg-72eef8ed52ca1d1dab6e21a58816bac9">OEM configuration</a></li>


    
  
    
    
	
<li>7: <a href="#pg-891dfa0a6f57b2aababf7ee877e38876">Upgrades</a></li>


    
  
    
    
	
<li>8: <a href="#pg-da6b91d86be15305a06525d5ddec51fc">GRUB</a></li>


    
  
    
    
	
<li>9: <a href="#pg-3255a8332bd6efb004f0d49c42343f6d">Runtime features</a></li>


    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-8637cd7f2ce65f4c97959f4d2a723eb9">1 - Stages</h1>
    <div class="lead">Configure the system in the various stages: boot, initramfs, fs, network, reconcile</div>
	<p>We have a custom augmented cloud-init syntax that allows to hook into various stages of the system, for example:</p>
<ul>
<li>Initramfs load</li>
<li>Boot</li>
<li>Network availability</li>
<li>During upgrades, installation, deployments  , and resets</li>
</ul>
<p><img src="https://docs.google.com/drawings/d/e/2PACX-1vRuITNgkCeDfS4LqxDvz2j4WxuRDzU8dJOTa5CY88ya8_hJ1QeaGKipTanggtiXiCxhwkUpYld-Cbxa/pub?w=885&amp;h=761" alt="Stages"></p>
<p>Cloud-init files in <code>/system/oem</code>, <code>/oem</code> and <code>/usr/local/oem</code> are applied in 5 different phases: <code>boot</code>, <code>network</code>, <code>fs</code>, <code>initramfs</code> and <code>reconcile</code>. All the available cloud-init keywords can be used in each stage. Additionally, it&rsquo;s possible also to hook before or after a stage has run, each one has a specific stage which is possible to run steps: <code>boot.after</code>, <code>network.before</code>, <code>fs.after</code> etc.</p>
<p>Multiple stages can be specified in a single cloud-init file.</p>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    <p>When a cOS derivative boots it creates sentinel files in order to allow to execute cloud-init steps programmaticaly.</p>
<ul>
<li><code>/run/cos/recovery_mode</code> is being created when booting from the recovery partition</li>
<li><code>/run/cos/live_mode</code> is created when booting from the LiveCD</li>
</ul>
<p>To execute a block using the sentinel files you can specify: <code>if: '[ -f &quot;/run/cos/...&quot; ]'</code>, see the examples below.</p>


</div>

<h2 id="stages">Stages</h2>
<p>Below there is a detailed list of the stages available that can be used in the cloud-init configuration files</p>
<h3 id="rootfs"><code>rootfs</code></h3>
<p>This is the earliest stage, running before switching root, just right after the
root is mounted in <code>/sysroot</code> and before applying the immutable rootfs configuration.
This stage is executed over initrd root, no chroot is applied.</p>
<p>Example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Set persistent devices&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">stage</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">rootfs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Layout configuration&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">environment_file</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/run/cos/cos-layout.env</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">environment</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">VOLUMES</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;LABEL=COS_OEM:/oem LABEL=COS_PERSISTENT:/usr/local&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">OVERLAY</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;tmpfs:25%&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h3 id="initramfs"><code>initramfs</code></h3>
<p>This is still an early stage, running before switching root. Here you can apply radical changes to the booting setup of <code>cOS</code>.
Despite this is executed before switching root this exection runs chrooted into the target root after the immutable rootfs is set up and ready.</p>
<p>Example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Run something on initramfs&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">stages</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#204a87;font-weight:bold">initramfs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Setting&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;[ ! -f &#34;/run/cos/recovery_mode&#34; ]&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span>- <span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">          # Run something when we are booting in active or passive
</span><span style="color:#8f5902;font-style:italic">          touch /etc/something_important</span><span style="color:#f8f8f8;text-decoration:underline">          
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Setting&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;[ -f &#34;/run/cos/recovery_mode&#34; ]&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span>- <span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">          </span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#8f5902;font-style:italic"># Run something when we are booting in recovery mode</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h3 id="boot"><code>boot</code></h3>
<p>This stage is executed after initramfs has switched root, during the <code>systemd</code> bootup process.</p>
<p>Example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Run something on boot&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">stages</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#204a87;font-weight:bold">boot</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Setting&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;[ ! -f &#34;/run/cos/recovery_mode&#34; ]&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span>- <span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">          </span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#8f5902;font-style:italic"># Run something when we are booting in active or passive</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Setting&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;[ -f &#34;/run/cos/recovery_mode&#34; ]&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span>- <span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">          </span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#8f5902;font-style:italic"># Run something when we are booting in recovery mode</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h3 id="fs"><code>fs</code></h3>
<p>This stage is executed when fs is mounted and is guaranteed to have access to <code>COS_STATE</code> and <code>COS_PERSISTENT</code>.</p>
<p>Example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Run something on boot&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">stages</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#204a87;font-weight:bold">fs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Setting&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;[ ! -f &#34;/run/cos/recovery_mode&#34; ]&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span>- <span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">          </span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#000">touch /usr/local/something</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Setting&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;[ -f &#34;/run/cos/recovery_mode&#34; ]&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span>- <span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">          </span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#8f5902;font-style:italic"># Run something when we are booting in recovery mode</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h3 id="network"><code>network</code></h3>
<p>This stage is executed when network is available</p>
<p>Example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Run something on boot&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">stages</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#204a87;font-weight:bold">network</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Setting&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;[ ! -f &#34;/run/cos/recovery_mode&#34; ]&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span>- <span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">          </span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#8f5902;font-style:italic"># Network is available, do something..</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h3 id="reconcile"><code>reconcile</code></h3>
<p>This stage is executed <code>5m</code> after boot and periodically each <code>60m</code>.</p>
<p>Example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Run something on boot&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">stages</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#204a87;font-weight:bold">reconcile</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Setting&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;[ ! -f &#34;/run/sentinel&#34; ]&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span>- <span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">          </span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#000">touch /run/sentinel</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h3 id="after-install"><code>after-install</code></h3>
<p>This stage is executed after installation of the OS has ended (last step of <code>elemental install</code>).</p>
<p>Example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Run something after installation&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">stages</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#204a87;font-weight:bold">after-install</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Setting&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;[ ! -f &#34;/run/cos/recovery_mode&#34; ]&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span>- <span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">          </span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#8f5902;font-style:italic"># Run something when we are booting in active or passive</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Setting&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;[ -f &#34;/run/cos/recovery_mode&#34; ]&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span>- <span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">          </span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#8f5902;font-style:italic"># Run something when we are booting in recovery mode</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h3 id="after-install-chroot"><code>after-install-chroot</code></h3>
<p>This stage is executed after installation of the OS has ended (last step of <code>elemental install</code>).


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    Steps executed at this stage are running <em>inside</em> the new OS as chroot, allowing to write persisting changes to the image,
for example by downloading and installing additional software.

</div>
</p>
<p>Example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Run something after installation&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">stages</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#204a87;font-weight:bold">after-install-chroot</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Setting&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span>- <span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">         </span><span style="color:#f8f8f8;text-decoration:underline">         </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h3 id="after-upgrade"><code>after-upgrade</code></h3>
<p>This stage is executed after upgrade of the OS has ended (last step of <code>elemental upgrade</code>).</p>
<p>Example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Run something after upgrade&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">stages</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#204a87;font-weight:bold">after-upgrade</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Setting&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;[ ! -f &#34;/run/cos/recovery_mode&#34; ]&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span>- <span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">          </span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#8f5902;font-style:italic"># Run something when we are booting in active or passive</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Setting&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;[ -f &#34;/run/cos/recovery_mode&#34; ]&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span>- <span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">          </span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#8f5902;font-style:italic"># Run something when we are booting in recovery mode</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h3 id="after-upgrade-chroot"><code>after-upgrade-chroot</code></h3>
<p>This stage is executed after upgrade of the OS has ended (after calling <code>elemental upgrade</code>).


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    Steps executed at this stage are running <em>inside</em> the new OS as chroot, allowing to write persisting changes to the image,
for example by downloading and installing additional software.

</div>
</p>
<p>Example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Run something after installation&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">stages</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#204a87;font-weight:bold">after-upgrade-chroot</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Setting&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span>- <span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">         </span><span style="color:#f8f8f8;text-decoration:underline">         </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h3 id="after-reset"><code>after-reset</code></h3>
<p>This stage is executed after reset of the OS has ended (last step of <code>elemental reset</code>).</p>
<p>Example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Run something after reset&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">stages</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#204a87;font-weight:bold">after-reset</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Setting&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;[ ! -f &#34;/run/cos/recovery_mode&#34; ]&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span>- <span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">          </span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#8f5902;font-style:italic"># Run something when we are booting in active or passive</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Setting&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;[ -f &#34;/run/cos/recovery_mode&#34; ]&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span>- <span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">          </span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#8f5902;font-style:italic"># Run something when we are booting in recovery mode</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h3 id="after-reset-chroot"><code>after-reset-chroot</code></h3>
<p>This stage is executed after reset of the OS has ended (last step of <code>elemental reset</code>).


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    Steps executed at this stage are running <em>inside</em> the new OS as chroot, allowing to write persisting changes to the image,
for example by downloading and installing additional software.

</div>
</p>
<p>Example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Run something after installation&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">stages</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#204a87;font-weight:bold">after-reset-chroot</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Setting&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span>- <span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">         </span><span style="color:#f8f8f8;text-decoration:underline">         </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h3 id="before-install"><code>before-install</code></h3>
<p>This stage is executed before installation (executed during <code>elemental install</code>).</p>
<p>Example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Run something before installation&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">stages</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#204a87;font-weight:bold">before-install</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Setting&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;[ ! -f &#34;/run/cos/recovery_mode&#34; ]&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span>- <span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">          </span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#8f5902;font-style:italic"># Run something when we are booting in active or passive</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Setting&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;[ -f &#34;/run/cos/recovery_mode&#34; ]&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span>- <span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">          </span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#8f5902;font-style:italic"># Run something when we are booting in recovery mode</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h3 id="before-upgrade"><code>before-upgrade</code></h3>
<p>This stage is executed before upgrade of the OS (executed during <code>elemental upgrade</code>).</p>
<p>Example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Run something before upgrade&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">stages</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#204a87;font-weight:bold">before-upgrade</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Setting&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;[ ! -f &#34;/run/cos/recovery_mode&#34; ]&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span>- <span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">          </span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#8f5902;font-style:italic"># Run something when we are booting in active or passive</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Setting&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;[ -f &#34;/run/cos/recovery_mode&#34; ]&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span>- <span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">          </span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#8f5902;font-style:italic"># Run something when we are booting in recovery mode</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h3 id="before-reset"><code>before-reset</code></h3>
<p>This stage is executed before reset of the OS (executed during <code>elemental reset</code>).</p>
<p>Example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Run something before reset&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">stages</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#204a87;font-weight:bold">before-reset</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Setting&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;[ ! -f &#34;/run/cos/recovery_mode&#34; ]&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span>- <span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">          </span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#8f5902;font-style:italic"># Run something when we are booting in active or passive</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Setting&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#39;[ -f &#34;/run/cos/recovery_mode&#34; ]&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span>- <span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">          </span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#8f5902;font-style:italic"># Run something when we are booting in recovery mode</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-80272a2426a531df16f16d019ccd6724">2 - Configuration persistency</h1>
    <div class="lead">Persisting configurations in cOS and derivatives</div>
	<p>By default cOS and derivatives are reading and executing cloud-init files in (lexicopgrahic) sequence inside:</p>
<ul>
<li><code>/system/oem</code></li>
<li><code>/usr/local/cloud-config</code></li>
<li><code>/oem</code></li>
</ul>
<p>It is also possible to run cloud-init file in a different location (URLs included, too) from boot cmdline by using  the <code>cos.setup=..</code> option.</p>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    It is possible to install a custom <a href="../../reference/cloud_init/">cloud-init style file</a> during install with <code>--cloud-init</code> flag on <code>elemental install</code> command or, it&rsquo;s possible to add one or more files manually inside the <code>/oem</code> directory after installation.

</div>

<p>While <code>/system/oem</code> is reserved for system configurations to be included directly in the derivative container image, the <code>/oem</code> folder instead is reserved for persistent cloud-init files that can be extended in runtime.</p>
<p>For example, if you want to change <code>/etc/issue</code> of the system persistently, you can create <code>/usr/local/cloud-config/90_after_install.yaml</code> or alternatively in <code>/oem/90_after_install.yaml</code> with the following content:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#8f5902;font-style:italic"># The following is executed before fs is setted up:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">stages</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">fs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;After install&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">files</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/etc/issue</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">content</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">                    </span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#000">Welcome, have fun!</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">permissions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0644</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">owner</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">systemctl</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">disable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#000">wicked</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;After install (second step)&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">files</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/etc/motd</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">content</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">                    </span><span style="color:#f8f8f8;text-decoration:underline">                    </span><span style="color:#000">Welcome, have more fun!</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">permissions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0644</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">owner</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">group</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>For more examples you can find <code>/system/oem</code> inside cOS vanilla images containing files used to configure on boot a pristine <code>cOS</code>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0f49c1b2fa940427a27c2c93a1d67077">3 - Runtime persistent changes</h1>
    <div class="lead">Applying changes to cOS images in runtime or “how to install a package in an immutable OS at runtime?”</div>
	<p>cOS and derivatives are <a href="../../reference/immutable_rootfs">immutable</a> systems. That means that any change in the running OS will not persist after a reboot.</p>
<p>While <a href="../configuration_persistency">configurations can be persisted</a>, there are occasions where installing a custom package or provide additional persistent files in the end system is needed.</p>
<p>We will see here a way to install packages, drivers, or apply any modification we might want to do in the OS image during runtime, without any need to rebuild the derivative container image. This will let any user (and not derivative developer) to apply any needed customization and to be able to persist across upgrades.</p>
<h2 id="transient-changes">Transient changes</h2>
<p>To apply transient changes, it&rsquo;s possible to boot a cOS derivative in read/write mode by specifying <code>rd.cos.debugrw</code> <a href="../../reference/immutable_rootfs">see here for more details</a>. This allows to do any change and will persist into the active/passive booting system (does NOT apply for recovery). Altough this methodology should be only considered for debugging purposes.</p>
<h2 id="persist-changes-with-cloud-init-files">Persist changes with Cloud init files</h2>
<p>Note: The following applies only to derivatives with 

<a href="https://rancher-sandbox.github.io/cos-toolkit-package-browser/find/utils/installer" class="btn btn-sm position-relative rounded-pill bg-light text-dark"
    role="button">
    <i class='fa fa-box'></i> utils/installer
</a>
 at version <code>0.17</code> or newer</p>
<p>cOS allows to apply a set of commands, or cloud-init steps, during upgrade, deploy, install and reset in the context of the target image, in RW capabilities. This allows to carry on changes during upgrades on the target image without the need to re-build or have a custom derivative image.</p>
<p>All the configuration that we want to apply to the system will run each time we do an upgrade, a reset or an installation on top of the new downloaded image (in case of upgrade) or the image which is the target system.</p>
<p>Between the available <a href="../stages">stages</a> in the <a href="../../reference/cloud_init/">cloud-init</a> there are <code>after-upgrade-chroot</code>,  <code>after-install-chroot</code>, <code>after-reset-chroot</code> and  <code>after-deploy-chroot</code>, for example, consider the following cloud-init file:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">stages</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Install something&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">stages</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#204a87;font-weight:bold">after-upgrade-chroot</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#000">zypper in -y ...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#204a87;font-weight:bold">after-reset-chroot</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#000">zypper in -y ...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#204a87;font-weight:bold">after-deploy-chroot</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#000">zypper in -y ...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#204a87;font-weight:bold">after-install-chroot</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#000">zypper in -y ...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>It will run the <code>zypper in -y ...</code> calls during each stage, in the context of the target system, allowing to customize the target image with additional packages.</p>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    <code>zypper</code> calls here are just an example. We could have used <code>dnf</code> for fedora based, or <code>apt-get</code> for ubuntu based images.

</div>

<p>When running the cloud-init steps the <code>/oem</code> partition and <code>/usr/local</code> will be mounted to <code>COS_OEM</code> and <code>COS_PERSISTENT</code> respectively, allowing to load extra data (e.g. rpm files, or configuration).</p>
<h2 id="example">Example</h2>
<p>If an user wants to install an additional package in the running system, and keep having that persistent across upgrades, he can copy the following file (<code>install.yaml</code>) inside the <code>/oem</code> folder, or <code>/usr/local/cloud-config</code>:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">stages</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;Install something&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">stages</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#204a87;font-weight:bold">after-upgrade-chroot</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span>- <span style="color:#204a87;font-weight:bold">commands</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#000">zypper in -y vim</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>and run <code>elemental upgrade</code>.</p>
<p>It will automatically upgrade the system with the changes above included.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-aab355bcbb96f01ee8dabb0f90e6df5a">4 - General Configuration</h1>
    <div class="lead">Configuring a cOS derivative</div>
	<p>cOS during installation, reset and upgrade (<code>elemental install</code>, <code>elemental reset</code> and <code>elemental upgrade</code> respectively) will read a configuration file in order to apply derivative customizations. The configuration files are sourced in precedence order and can be located in the following places:</p>
<ul>
<li><code>/etc/environment</code></li>
<li><code>/etc/os-release</code></li>
<li><code>/etc/cos/config</code></li>
</ul>
<p>Below you can find a full example of the config file:</p>





<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># cOS configuration file</span>
<span style="color:#8f5902;font-style:italic"># This file allows to tweak cOS configuration such as: default upgrade/recovery image and GRUB menu entry</span>

<span style="color:#8f5902;font-style:italic"># Disable/enable image verification during upgrades ( default: false )</span>
<span style="color:#8f5902;font-style:italic">#NO_VERIFY=false</span>

<span style="color:#8f5902;font-style:italic"># Disable/enable upgrades via release channels instead of container images. ( default: true )</span>
<span style="color:#8f5902;font-style:italic">#CHANNEL_UPGRADES=false</span>

<span style="color:#8f5902;font-style:italic"># Default container image used for upgrades. ( defaults to system/cos with channel CHANNEL_UPGRADES enabled )</span>
<span style="color:#8f5902;font-style:italic">#UPGRADE_IMAGE=&#34;quay.io/mudler/cos-test:cos-standard&#34;</span>

<span style="color:#8f5902;font-style:italic"># Default recovery image to use when upgrading the recovery partition</span>
<span style="color:#8f5902;font-style:italic"># ( defaults to recovery/cos in vanilla cOS images with channel CHANNEL_UPGRADES enabled. Otherwise it defaults to UPGRADE_IMAGE ).</span>
<span style="color:#8f5902;font-style:italic">#RECOVERY_IMAGE=&#34;quay.io/mudler/cos-test:cos-standard&#34;</span>

<span style="color:#8f5902;font-style:italic"># GRUB entry to display on boot. ( defaults: cOS )</span>
<span style="color:#8f5902;font-style:italic">#GRUB_ENTRY_NAME=&#34;example&#34;</span>

<span style="color:#8f5902;font-style:italic"># Space separated list of additional paths that are used to</span>
<span style="color:#8f5902;font-style:italic"># source cloud-config from. ( defaults paths are: /system/oem /oem/ /usr/local/cloud-config/ )</span>
<span style="color:#8f5902;font-style:italic">#CLOUD_INIT_PATHS=&#34;&#34;</span>

<span style="color:#8f5902;font-style:italic"># This is the directory that can be used to store cloud-init files that can be enabled/disabled in runtime</span>
<span style="color:#8f5902;font-style:italic"># by cos-features. ( defaults to /system/features )</span>
<span style="color:#8f5902;font-style:italic">#COS_FEATURESDIR=&#34;/system/features&#34;</span>

<span style="color:#8f5902;font-style:italic"># This is the repository that hosts the signature files used by cosign and luet-cosign plugin during upgrade/deploy to</span>
<span style="color:#8f5902;font-style:italic"># check the artifact signatures</span>
<span style="color:#8f5902;font-style:italic">#COSIGN_REPOSITORY=&#34;raccos/releases-green&#34;</span>

<span style="color:#8f5902;font-style:italic"># This sets keyless verify on building packages with luet and the luet-cosign plugin.</span>
<span style="color:#8f5902;font-style:italic"># 1  = enabled keyless, 0 = disabled, uses normal public key verification</span>
<span style="color:#8f5902;font-style:italic">#COSIGN_EXPERIMENTAL=1</span>

<span style="color:#8f5902;font-style:italic"># This sets the location of the public key to use to verify the packages installed by luet during upgrade/deploy</span>
<span style="color:#8f5902;font-style:italic"># This can be set to file, URL, KMS URI or Kubernetes Secret</span>
<span style="color:#8f5902;font-style:italic"># This is only used if COSIGN_EXPERIMENTAL is set to 0</span>
<span style="color:#8f5902;font-style:italic">#COSIGN_PUBLIC_KEY_LOCATION=&#34;&#34;</span>

<span style="color:#8f5902;font-style:italic"># Default size (in MB) of disk image files (.img) created during upgrades</span>
<span style="color:#8f5902;font-style:italic">#DEFAULT_IMAGE_SIZE=3240</span>

<span style="color:#8f5902;font-style:italic"># Path to default configuration grub file</span>
<span style="color:#8f5902;font-style:italic">#GRUBCONF=&#34;/etc/cos/grub.cfg&#34;</span>

<span style="color:#8f5902;font-style:italic"># Label of the OEM volume</span>
<span style="color:#000">OEM_LABEL</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;COS_OEM&#34;</span>

<span style="color:#8f5902;font-style:italic"># Label of the PERSISTENT volume</span>
<span style="color:#000">PERSISTENT_LABEL</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;COS_PERSISTENT&#34;</span>

<span style="color:#8f5902;font-style:italic"># Label of the RECOVERY volume</span>
<span style="color:#000">RECOVERY_LABEL</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;COS_RECOVERY&#34;</span>

<span style="color:#8f5902;font-style:italic"># Label of the STATE volume</span>
<span style="color:#000">STATE_LABEL</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;COS_STATE&#34;</span>

<span style="color:#8f5902;font-style:italic"># Label of the ACTIVE volume</span>
<span style="color:#000">ACTIVE_LABEL</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;COS_ACTIVE&#34;</span>

<span style="color:#8f5902;font-style:italic"># Label of the PASSIVE volume</span>
<span style="color:#000">PASSIVE_LABEL</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;COS_PASSIVE&#34;</span>

<span style="color:#8f5902;font-style:italic"># Label of the SYSTEM volume</span>
<span style="color:#000">SYSTEM_LABEL</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;COS_SYSTEM&#34;</span>
</code></pre></div>

<small> <i class='fab fa-github'></i> <i>Complete source code:  <a target=_blank href="https://github.com/rancher-sandbox/cos-toolkit/blob/master/packages/cos-config/cos-config">https://github.com/rancher-sandbox/cos-toolkit/blob/master/packages/cos-config/cos-config</a></i> </small>
<hr>


</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4c6f31346340371adbb7fd2ceccc2e88">5 - Login</h1>
    <div class="lead">Default login, and how to override it</div>
	<p>By default you can login with the user <code>root</code> and <code>cos</code> in a vanilla cOS image, this is also set automatically by the 

<a href="https://rancher-sandbox.github.io/cos-toolkit-package-browser/find/system/cloud-config" class="btn btn-sm position-relative rounded-pill bg-light text-dark"
    role="button">
    <i class='fa fa-box'></i> system/cloud-config
</a>
 package if used by a derivative.</p>
<p>You can change this by overriding <code>/system/oem/04_accounting.yaml</code> in the container image if present, or via <a href="../../reference/cloud_init/#stagesstage_idstep_nameusers">cloud-init</a>.</p>
<h3 id="examples">Examples</h3>
<ul>
<li><a href="https://github.com/mudler/c3os/blob/master/files/system/oem/10_accounting.yaml">Example accounting file</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-72eef8ed52ca1d1dab6e21a58816bac9">6 - OEM configuration</h1>
    <div class="lead">OEM configuration reserved to cOS and derivatives</div>
	<p>There are several way to customize cOS and a cos-toolkit derivative:</p>
<ul>
<li>declaratively in runtime with cloud-config file (by overriding, or extending)</li>
<li>stateful, embedding any configuration in the container image to be booted.</li>
</ul>
<p>For runtime persistence configuration, the only supported way is with cloud-config files, <a href="../configuration_persistency">see the relevant docs</a>.</p>
<p>A derivative automatically loads and executes cloud-config files during the various system <a href="../stages">stages</a> also inside <code>/system/oem</code> which is read-only and reserved to the system.</p>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    The cloud-config mechanism works also as an emitter event pattern - running services or programs can emit new custom <code>stages</code> in runtime by running <code>cos-setup stage_name</code>.

</div>

<p>Derivatives that wish to override default configurations can do that by placing extra cloud-init file, or overriding completely <code>/system/oem</code> in the target image.</p>
<p>This is to setup for example, the default root password or the prefered upgrade channel.</p>
<p>The following are the <code>cOS</code> default oem files, which are shipped within the 

<a href="https://rancher-sandbox.github.io/cos-toolkit-package-browser/find/system/cloud-config" class="btn btn-sm position-relative rounded-pill bg-light text-dark"
    role="button">
    <i class='fa fa-box'></i> system/cloud-config
</a>
, which is an optional package:</p>
<pre><code>/system/oem/00_rootfs.yaml - defines the rootfs mountpoint layout setting
/system/oem/01_defaults.yaml - systemd defaults (keyboard layout, timezone)
/system/oem/02_upgrades.yaml - Settings for cOS vanilla channel upgrades
/system/oem/03_branding.yaml - Branding setting, Derivative name, /etc/issue content
/system/oem/04_accounting.yaml - Default user/pass
/system/oem/05_network.yaml - Default network setup
/system/oem/06_recovery.yaml - Executes additional commands when booting in recovery mode
</code></pre><p>You can either override the above files, or alternatively not consume the 

<a href="https://rancher-sandbox.github.io/cos-toolkit-package-browser/find/system/cloud-config" class="btn btn-sm position-relative rounded-pill bg-light text-dark"
    role="button">
    <i class='fa fa-box'></i> system/cloud-config
</a>
 package while building a derivative.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-891dfa0a6f57b2aababf7ee877e38876">7 - Upgrades</h1>
    <div class="lead">Customizing the default upgrade channel</div>
	<p><code>cOS</code> vanilla images by default are picking upgrades by the standard upgrade channel. It means it will always get the latest published <code>cOS</code> version by our CI.</p>
<p>However, it&rsquo;s possible to tweak the default behavior of <code>elemental upgrade</code> to point to a specific docker image/tag, or a different release channel.</p>
<p>By default, <code>cos</code> derivatives if not specified will point to latest <code>cos-toolkit</code>. To override, you need to or overwrite the content of <code>/system/oem/02_upgrades.yaml</code> or supply an additional one, e.g. <code>/system/oem/03_upgrades.yaml</code> in the final image, see <a href="https://github.com/rancher-sandbox/cOS-toolkit/blob/master/packages/cloud-config/oem/02_upgrades.yaml">the default here</a>.</p>
<h2 id="configuration">Configuration</h2>
<p><code>elemental upgrade</code> during start reads the <a href="../general_configuration">cOS configuration file</a> and allows to tweak the following:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># Tweak the package to upgrade to, or the docker image (full reference)</span>
<span style="color:#000">ELEMENTAL_UPGRADE_IMAGE</span><span style="color:#ce5c00;font-weight:bold">=</span>system/cos
<span style="color:#8f5902;font-style:italic"># Turn on/off channel upgrades. If disabled, UPGRADE_IMAGE should be a full reference to a container image</span>
<span style="color:#000">ELEMENTAL_CHANNEL_UPGRADES</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>
<span style="color:#8f5902;font-style:italic"># Disable mtree verification. Enabled by default</span>
<span style="color:#000">ELEMENTAL_NO_VERIFY</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>
<span style="color:#8f5902;font-style:italic"># Specify a separate recovery image (defaults to UPGRADE_IMAGE)</span>
<span style="color:#000">ELEMENTAL_RECOVERY_IMAGE</span><span style="color:#ce5c00;font-weight:bold">=</span>recovery/cos
</code></pre></div><p><code>elemental upgrade</code> also reads its configuration from <code>/etc/cos-upgrade-image</code> if the file is present in the system.</p>
<p>Specifically, it allows to configure:</p>
<ul>
<li><strong>ELEMENTAL_UPGRADE_IMAGE</strong>: A container image reference ( e.g. <code>registry.io/org/image:tag</code> ) or a <code>luet</code> package ( e.g. <code>system/cos</code> )</li>
<li><strong>ELEMENTAL_CHANNEL_UPGRADES</strong>: Boolean indicating wether to use channel upgrades or not. If it is disabled <strong>UPGRADE_IMAGE</strong> should refer to a container image, e.g. <code>registry.io/org/image:tag</code></li>
<li><strong>ELEMENTAL_NO_VERIFY</strong>: Turns off or on mtree verification.</li>
<li><strong>ELEMENTAL_RECOVERY_IMAGE</strong>: Allows to specify a different image for the recovery partition. Similarly to <strong>UPGRADE_IMAGE</strong> needs to be either an image reference or a package.</li>
</ul>
<h2 id="changing-the-default-release-channel">Changing the default release channel</h2>
<p>Release channels are standard luet repositories. To change the default release channel, create a <code>/etc/luet/luet.yaml</code> configuration file pointing to a valid luet repository:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#8f5902;font-style:italic"># For a full reference, see:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># https://luet-lab.github.io/docs/docs/getting-started/#configuration</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">logging</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">color</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">enable_emoji</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">general</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">debug</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spinner_charset</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">9</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">repositories</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;sampleos&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">description</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;sampleOS&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;docker&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">enable</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">cached</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">priority</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verify</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">urls</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;quay.io/costoolkit/releases-green&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-da6b91d86be15305a06525d5ddec51fc">8 - GRUB</h1>
    <div class="lead">GRUB 2 Configuration</div>
	<p>COS is set to deploy a persistent <code>grub.cfg</code> into the <code>COS_RECOVERY</code> partition during
the system installation or image creation. COS grub configuration
includes three menu entries: first for the main OS system, second for the
fallback OS system and a third for the recovery OS.</p>
<p>For example the main OS system menu entry could be something like:</p>
<pre><code>menuentry &quot;cOS&quot; --id cos {
  search.fs_label COS_STATE root
  set img=/cOS/active.img
  set label=COS_ACTIVE
  loopback loop0 /$img
  set root=($root)
  source (loop0)/etc/cos/bootargs.cfg
  linux (loop0)$kernel $kernelcmd
  initrd (loop0)$initramfs
}
</code></pre>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Kernel parameters</h4>

    The kernel parameters are not part of the persistent <code>grub.cfg</code> file stored in <code>COS_RECOVERY</code> partition.
Kernel parameters are sourced from the loop device of the OS image to boot. This is mainly to
keep kernel parameters consistent across different potential OS images or
system upgrades.

</div>

<h2 id="specifying-default-custom-boot-options">Specifying default custom boot options</h2>
<p>cOS images and its derivatives, are expected to include a
<code>/etc/cos/bootargs.cfg</code> file which provides the definition of the following
variables:</p>
<ul>
<li><code>$kernel</code>: Path of the kernel binary</li>
<li><code>$kernelcmd</code>: Kernel parameters</li>
<li><code>$initramfs</code>: Path of the initrd binary</li>
</ul>
<p>This is the mechanism any cOS image or cOS derivative has to communicate
its boot parameters (kernel, kernel params and initrd file) to GRUB2.</p>
<p>For example, the default cOS bootarg.cfg file is:</p>
<pre><code>set kernel=/boot/vmlinuz
if [ -n &quot;$recoverylabel&quot; ]; then
    # Boot arguments when the image is used as recovery
    set kernelcmd=&quot;console=tty1 root=live:CDLABEL=$recoverylabel rd.live.dir=/ rd.live.squashimg=$img panic=5&quot;
else
    # Boot arguments when the image is used as active/passive
    set kernelcmd=&quot;console=tty1 root=LABEL=$label iso-scan/filename=$img panic=5 security=selinux rd.cos.oemlabel=COS_OEM selinux=1&quot;
fi

set initramfs=/boot/initrd
</code></pre><p>You can tweak that file to suit your needs if you need to specify persistent boot arguments.</p>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    <code>rd.cos.oemlabel=COS_OEM</code> is required inside the bootargs in order to access to the <code>/oem</code> mount within the rootfs stage. <code>COS_OEM</code> is the default label for the oem partition.

</div>

<h2 id="grub-environment-variables">Grub environment variables</h2>
<p>cOS (since v0.5.8) makes use of the GRUB2 environment block which can used to define
persistent GRUB2 variables across reboots.</p>
<p>Use <code>grub2-editenv</code> command line utility to define the desired values.</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>next_entry</td>
<td>Set the next reboot entry</td>
</tr>
<tr>
<td>saved_entry</td>
<td>Set the default boot entry</td>
</tr>
<tr>
<td>default_menu_entry</td>
<td>Set the name entries on the GRUB menu</td>
</tr>
<tr>
<td>extra_active_cmdline</td>
<td>Set additional boot commands when booting into active</td>
</tr>
<tr>
<td>extra_passive_cmdline</td>
<td>Set additional boot commands when booting into passive</td>
</tr>
<tr>
<td>extra_recovery_cmdline</td>
<td>Set additional boot commands when booting into recovery</td>
</tr>
<tr>
<td>extra_cmdline</td>
<td>Set additional boot commands for all entries</td>
</tr>
<tr>
<td>default_fallback</td>
<td>Sets default fallback logic</td>
</tr>
</tbody>
</table>
<p>For instance use the following command to reboot to recovery system only once:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt; grub2-editenv /oem/grubenv <span style="color:#204a87">set</span> <span style="color:#000">next_entry</span><span style="color:#ce5c00;font-weight:bold">=</span>recovery
</code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    The examples below make of the <code>COS_OEM</code> device, however it could use any device
detected by GRUB2 that includes the file <code>/grubenv</code>. First match wins.

</div>

<h3 id="default-boot-entry">Default boot entry</h3>
<p>The default grub configuration loads the <code>/grubenv</code> of any available device
and evaluates on <code>next_entry</code> variable and <code>saved_entry</code> variable. By default
none is set.</p>
<p>The default boot entry is set to the value of <code>saved_entry</code>, in case the variable
is not set grub just defaults to the first menu entry.</p>
<p><code>next_entry</code> variable can be used to overwrite the default boot entry for a single
boot. If <code>next_entry</code> variable is set this is only being used once, GRUB2 will
unset it after reading it for the first time. This is helpful to define the menu entry
to reboot to without having to make any permanent config change.</p>
<p>Use <code>grub2-editenv</code> command line utility to define desired values.</p>
<p>For instance use the following command to reboot to recovery system only once:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt; grub2-editenv /oem/grubenv <span style="color:#204a87">set</span> <span style="color:#000">next_entry</span><span style="color:#ce5c00;font-weight:bold">=</span>recovery
</code></pre></div><p>Or to set the default entry to <code>fallback</code> system:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt; grub2-editenv /oem/grubenv <span style="color:#204a87">set</span> <span style="color:#000">saved_entry</span><span style="color:#ce5c00;font-weight:bold">=</span>fallback
</code></pre></div><h2 id="boot-menu">Boot menu</h2>
<p>By default <code>cOS</code> and derivatives shows the default boot menu entry while booting (<code>cOS</code>).</p>
<p>The grub menu entry is generated during installation and can be configured by setting <code>GRUB_ENTRY_NAME</code> in the <a href="../general_configuration">cOS configuration file</a> inside the derivative, or either via cloud-init before installation.</p>
<p>For example, specifying in <code>/etc/cos/config</code>:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#000">GRUB_ENTRY_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span>myOS
</code></pre></div><p>will automatically set the GRUB menu entries for active, passive and recovery to the specified value.</p>
<p>The grub menu boot entry can also be set with <code>grub2-editenv</code>:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt; grub2-editenv /oem/grubenv <span style="color:#204a87">set</span> <span style="color:#000">default_menu_entry</span><span style="color:#ce5c00;font-weight:bold">=</span>fooOS
</code></pre></div>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Additional menu entries</h4>

    <p>Since</p>
<p><a href="https://rancher-sandbox.github.io/cos-toolkit-package-browser/find/system/grub2-config" class="btn btn-sm position-relative rounded-pill bg-light text-dark"
role="button">
<i class='fa fa-box'></i> system/grub2-config
</a></p>
<blockquote>
<p>= 0.0.14 it is possible to add multiple custom menu entries to GRUB by creating a <code>/grubmenu</code> config file in one of the available partitions detected by GRUB2 during boot. The file will be loaded from the first partition found by GRUB that have the <code>grubmenu</code> file. First match wins.
The <code>grubmenu</code> file will be sourced at the end of the boot process, and can contain several <code>menuentry</code> blocks.</p>
</blockquote>


</div>

<h2 id="persistent-boot-option-flags">Persistent boot option flags</h2>
<p>It is possible to define persistent boot flag for each menu entry also via <code>grub2-editenv</code>:</p>
<ul>
<li><code>extra_active_cmdline</code>: extra bootflags to be applied only on active boot</li>
<li><code>extra_passive_cmdline</code>: extra bootflags to be applied only on passive boot</li>
<li><code>extra_recovery_cmdline</code>: extra bootflags to be applied only on recovery</li>
<li><code>extra_cmdline</code>: will be applied to each boot entry</li>
</ul>
<h2 id="customizing-fallback-logic">Customizing fallback logic</h2>
<p>By default cOS boots into active, and if there are failures will boot into the passive, and finally if keeps failing, will boot into recovery.</p>
<p>It is possible to override the default fallback logic by setting <code>default_fallback</code> as grub environment, consider for example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt; grub2-editenv /oem/grubenv <span style="color:#204a87">set</span> <span style="color:#000">default_fallback</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;2 0 1&#34;</span>
</code></pre></div><p>Will set the default fallback to &ldquo;2 0 1&rdquo; instead of the default &ldquo;0 1 2&rdquo;.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-3255a8332bd6efb004f0d49c42343f6d">9 - Runtime features</h1>
    <div class="lead">Add features that can be enabled and disabled on runtime</div>
	<p>cOS allows to (optionally) add features that can be disabled/enabled in runtime, provided by 

<a href="https://rancher-sandbox.github.io/cos-toolkit-package-browser/find/system/cos-features" class="btn btn-sm position-relative rounded-pill bg-light text-dark"
    role="button">
    <i class='fa fa-box'></i> system/cos-features
</a>
.</p>
<p><a href="../../reference/cloud_init">Cloud-init files</a> stored in <code>/system/features</code> are read by <code>cos-feature</code> and allow to interactively enable or disable them in a running system, for example:</p>
<pre><code>$&gt; cos-feature list

====================
cOS features list

To enable, run: cos-feature enable &lt;feature&gt;
To disable, run: cos-feature disable &lt;feature&gt;
====================

- vagrant (enabled)
- ...
...
</code></pre>

<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Note</h4>

    <code>/system/features</code> is the default path which can be customized in the <a href="../general_configuration">cOS configuration file</a> by specifying it with <code>COS_FEATURESDIR</code>.

</div>

<p>By default cOS ships the <code>vagrant</code> featureset - when enabled will automatically create the default <code>vagrant</code> user which is generally used to create new Vagrant boxes.</p>
<p>If you don&rsquo;t need <code>cos-features</code> you can avoid installing 

<a href="https://rancher-sandbox.github.io/cos-toolkit-package-browser/find/system/cos-features" class="btn btn-sm position-relative rounded-pill bg-light text-dark"
    role="button">
    <i class='fa fa-box'></i> system/cos-features
</a>
, it&rsquo;s optional.</p>
<h2 id="adding-or-removing-features">Adding or removing features</h2>
<p>To either add or remove the available features, delete the relevant files in the <code>/system/features</code> folder of the derivative prior to build the <a href="../../creating-derivatives/creating_bootable_images">container image</a>.</p>

</div>



    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" rel="noopener" href="https://rancher-users.slack.com/messages/cos-toolkit" aria-label="Slack">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 SUSE LLC All Rights Reserved</small>
        <small class="ml-1"><a href="https://www.suse.com/company/legal/" target="_blank" rel="noopener">Privacy Policy</a></small>
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>






 













<script src="https://github.com/rancher-sandbox/cOS-toolkit/js/main.min.3b172c13b62c2bea8b1c9d2599cddc8cf89718a92d792c680871c81ba43d8c85.js" integrity="sha256-OxcsE7YsK&#43;qLHJ0lmc3cjPiXGKkteSxoCHHIG6Q9jIU=" crossorigin="anonymous"></script>



<script src='https://github.com/rancher-sandbox/cOS-toolkit/js/prism.js'></script>



  </body>
</html>
